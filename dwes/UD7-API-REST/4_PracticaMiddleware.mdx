## Ejemplo Middleware Global

Crear, registrar y usar un **Middleware Global** en  **Laravel 12**

---

## üîπ **Ejemplo Completo: Creaci√≥n de un Middleware Global en Laravel 11**

Supongamos que queremos crear un middleware global llamado **CheckMaintenanceMode** que bloquee el acceso al sitio si est√° en modo mantenimiento.

---

### 1Ô∏è‚É£ **Crear el Middleware**

Ejecuta el siguiente comando en la terminal:

```bash
php artisan make:middleware CheckMaintenanceMode
```

Esto generar√° un archivo en:

```
app/Http/Middleware/CheckMaintenanceMode.php
```

---

### 2Ô∏è‚É£ **Implementar la L√≥gica en el Middleware**

Abre `app/Http/Middleware/CheckMaintenanceMode.php` y agrega la l√≥gica:

```php
<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;

class CheckMaintenanceMode
{
    public function handle(Request $request, Closure $next): Response
    {
        // Verificar si la aplicaci√≥n est√° en modo mantenimiento
        if (env('MAINTENANCE_MODE', false)) {
            return response()->json(['error' => 'El sitio est√° en mantenimiento'], 503);
        }

        // Continuar con la solicitud
        return $next($request);
    }
}
```

üìå  **Explicaci√≥n** :

* Si la variable `MAINTENANCE_MODE` en el archivo `.env` est√° en `true`, el middleware devuelve un mensaje de mantenimiento con c√≥digo HTTP `503`.
* Si no est√° activado, permite continuar la solicitud (`$next($request)`).

---

### 3Ô∏è‚É£ **Registrar el Middleware Global**

En Laravel 11, los **middlewares globales** se configuran en `bootstrap/app.php`.

üìç  **Modifica `bootstrap/app.php` y agrega el middleware en la secci√≥n `middleware()`** :

```php
$app->middleware([
    \App\Http\Middleware\CheckMaintenanceMode::class, // ‚Üê Registramos el middleware global
]);
```

üîπ **Esto hace que el middleware se ejecute en todas las rutas de la aplicaci√≥n.**

---

### 4Ô∏è‚É£ **Configurar el Modo Mantenimiento en `.env`**

Abre el archivo `.env` y agrega esta l√≠nea:

```
MAINTENANCE_MODE=true
```

Cuando este valor es `true`, todas las peticiones ser√°n bloqueadas con el mensaje de mantenimiento.

Si quieres desactivar el mantenimiento, cambia `false` y reinicia el servidor.

---

### 5Ô∏è‚É£ **Probar el Middleware**

Ejecuta el servidor con:

```bash
php artisan serve
```

Y visita cualquier ruta, por ejemplo:

```
http://127.0.0.1:8000/
```

Si `MAINTENANCE_MODE=true`, obtendr√°s:

```json
{
    "error": "El sitio est√° en mantenimiento"
}
```

Si `MAINTENANCE_MODE=false`, el sitio funcionar√° normalmente.

---

## ‚úÖ **Conclusi√≥n**

Ahora tienes un **middleware global** funcionando en Laravel 11 sin usar `Kernel.php`. üöÄ

Este enfoque es ideal para aplicar l√≥gica a  **todas las rutas autom√°ticamente** , como:

‚úî Autenticaci√≥n global

‚úî Restricciones por IP

‚úî Registro de actividad

‚úî Protecci√≥n contra ataques

---

¬øNecesitas m√°s detalles o un caso diferente? ü§ì
