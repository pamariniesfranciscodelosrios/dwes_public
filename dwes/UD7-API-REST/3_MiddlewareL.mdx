## Cambios en Laravel 12

(con respeccto a los Middleware)

En Laravel 11, la estructura del framework ha evolucionado, y algunos archivos y configuraciones han cambiado. Si ya no encuentras el archivo `app/Http/Kernel.php`, es porque Laravel ha simplificado la forma en que se manejan los middlewares.

En Laravel 11, los middlewares se registran directamente en el archivo `bootstrap/app.php`. Aqu√≠ te explico c√≥mo a√±adir un nuevo middleware en Laravel 11:

### 1. Crear el Middleware

Primero, crea el middleware si a√∫n no lo has hecho. Puedes usar el comando de Artisan para generar un nuevo middleware:

```bash
php artisan make:middleware NombreDelMiddleware
```

Esto crear√° un archivo en `app/Http/Middleware/NombreDelMiddleware.php`.

### 2. Registrar el Middleware

En Laravel 11, los middlewares se registran en el archivo `bootstrap/app.php`. Abre este archivo y busca la secci√≥n donde se registran los middlewares. Deber√≠as ver algo como esto:

```php
$app->middleware([
    // Middlewares globales
]);

$app->middlewareGroups([
    'web' => [
        // Middlewares para el grupo 'web'
    ],
    'api' => [
        // Middlewares para el grupo 'api'
    ],
]);

$app->routeMiddleware([
    // Middlewares de ruta
]);
```

#### Middleware Global

Si quieres que el middleware se aplique a todas las solicitudes, reg√≠stralo en la secci√≥n `$app->middleware([])`:

```php
$app->middleware([
    \App\Http\Middleware\NombreDelMiddleware::class,
    // Otros middlewares globales
]);
```

#### Middleware de Grupo

Si quieres que el middleware se aplique solo a un grupo espec√≠fico (como `web` o `api`), reg√≠stralo en la secci√≥n correspondiente:

```php
$app->middlewareGroups([
    'web' => [
        \App\Http\Middleware\NombreDelMiddleware::class,
        // Otros middlewares para el grupo 'web'
    ],
    'api' => [
        // Middlewares para el grupo 'api'
    ],
]);
```

#### Middleware de Ruta

Si quieres aplicar el middleware solo a rutas espec√≠ficas, reg√≠stralo en la secci√≥n `$app->routeMiddleware([])`:

```php
$app->routeMiddleware([
    'nombre' => \App\Http\Middleware\NombreDelMiddleware::class,
    // Otros middlewares de ruta
]);
```

Luego, puedes aplicar este middleware a rutas espec√≠ficas usando el alias que has definido:

```php
Route::get('/ruta', function () {
    // ...
})->middleware('nombre');
```

### 3. Aplicar el Middleware

Dependiendo de c√≥mo hayas registrado el middleware, se aplicar√° autom√°ticamente a todas las solicitudes, a un grupo de rutas, o a rutas espec√≠ficas.

### 4. (Opcional) Modificar el Comportamiento del Middleware

Si necesitas modificar el comportamiento del middleware, puedes hacerlo en el archivo `app/Http/Middleware/NombreDelMiddleware.php`.

## Aplicar de forma m√°s directa desde rutas

### 1Ô∏è‚É£ Crear el Middleware

Ejecuta el siguiente comando para generar un middleware:

```bash
php artisan make:middleware MiNuevoMiddleware
```

Esto crear√° el archivo en:

```
app/Http/Middleware/MiNuevoMiddleware.php
```

### 2Ô∏è‚É£ Definir la l√≥gica del Middleware

Abre el archivo reci√©n creado y agrega la l√≥gica en el m√©todo `handle`:

```php
<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;

class MiNuevoMiddleware
{
    public function handle(Request $request, Closure $next): Response
    {
        // Aqu√≠ puedes agregar l√≥gica personalizada
        if (!$request->has('token')) {
            return response()->json(['error' => 'Token requerido'], 403);
        }

        return $next($request);
    }
}
```

### 3Ô∏è‚É£ Registrar el Middleware

Dado que `Kernel.php` ya no se usa, Laravel 11 maneja el middleware de forma autom√°tica con  **Service Providers** .

#### üîπ Opci√≥n 1: Middleware Global (Para todas las rutas)

Abre `bootstrap/app.php` y registra el middleware en la configuraci√≥n del framework:

```php
$app->middleware([
    \App\Http\Middleware\MiNuevoMiddleware::class,
]);
```

#### üîπ Opci√≥n 2: Middleware de Grupo (Por ejemplo, para `web` o `api`)

Si deseas que tu middleware se aplique solo a un grupo de rutas, modif√≠calo en `routes/web.php` o `routes/api.php` as√≠:

```php
use App\Http\Middleware\MiNuevoMiddleware;

Route::middleware([MiNuevoMiddleware::class])->group(function () {
    Route::get('/dashboard', function () {
        return "Acceso permitido";
    });
});
```

#### üîπ Opci√≥n 3: Middleware en una Ruta Espec√≠fica

Puedes aplicarlo directamente en una ruta espec√≠fica:

```php
Route::get('/perfil', function () {
    return "Perfil del usuario";
})->middleware(\App\Http\Middleware\MiNuevoMiddleware::class);
```

### ‚úÖ **Conclusi√≥n**

En Laravel 11, el middleware ya no se registra en `Kernel.php`. Ahora se agrega en `bootstrap/app.php` o directamente en las rutas usando `middleware()`. Esto hace que la aplicaci√≥n sea m√°s flexible y modular.

### Resumen

En Laravel 11, los middlewares se registran en `bootstrap/app.php` en lugar de `app/Http/Kernel.php`. 

* Puedes registrar middlewares globales, de grupo o de ruta seg√∫n tus necesidades.
